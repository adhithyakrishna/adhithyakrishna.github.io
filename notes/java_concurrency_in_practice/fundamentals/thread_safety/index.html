<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Ch01 - Thread Safety â€“ Akrishna</title><script defer src=/js/fuse.min.94c78ad70b02749822921660cf4e9f0b3701bc0680c421afb784a78228de0275.js></script><script src=/js/enquire.min.dfb99dee1e029d51d6cfb672d847929890b1585402de17f5ed092edd72a688b4.js></script><script defer src=/js/lazysizes.min.31dd6a2d3a1ec0f78a8df007535cf23f03aeb5c70f026e6d6a19dac3b3acc340.js></script><script defer src=/js/helper/getParents.min.1618c696be7c98933f9a92677f518b512a74e55bdbb976b09936b4182e93181b.js></script><script defer src=/js/helper/fadeinout.min.93a331f96194789a542f33690bbe4f0c102c7e78ffc018217f5a1c33010bad91.js></script><script>"use strict";window.onload=function(){var languagedir=JSON.parse("\"ltr\"");var baseurl=JSON.parse("\"https://adhithyakrishna.github.io/\"");var permalink=JSON.parse("\"https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/\"");var toggleSidebarElem=document.getElementById("toggle-sidebar");var toggleMenuElem=document.getElementById("toggle-menu");var tocBodyElem=document.querySelector('.toc__body');var tocLabelElem=document.querySelector('.toc__label');var listMainElem=document.getElementById('list-main');var listSideElem=document.getElementById('list-side');var singleMenuElem=document.getElementById('single-menu');var sliderIcons=document.querySelectorAll('.slider__icon');toggleSidebarElem?toggleSidebarElem.addEventListener('change',function(e){if(e.target.checked){if(tocBodyElem){fadeIn(tocBodyElem,200);}
if(tocLabelElem){fadeIn(tocLabelElem,200);}
if(listMainElem&&listSideElem){listMainElem.className='m';listSideElem.className='r';}
sliderIcons&&sliderIcons.forEach(function(elem){if(elem.classList.contains('hide')){elem.classList.remove('hide');}else{elem.classList.add('hide');}});}else{if(tocBodyElem){fadeOut(tocBodyElem,200);}
if(tocLabelElem){fadeOut(tocLabelElem,200);}
if(listMainElem&&listSideElem){listMainElem.className='mr';listSideElem.className='hide';}
sliderIcons&&sliderIcons.forEach(function(elem){if(elem.classList.contains('hide')){elem.classList.remove('hide');}else{elem.classList.add('hide');}});}}):null;toggleMenuElem?toggleMenuElem.addEventListener('change',function(e){if(e.target.checked){if(listMainElem&&singleMenuElem){listMainElem.className='m';singleMenuElem.className='l';}
sliderIcons&&sliderIcons.forEach(function(elem){if(elem.classList.contains('hide')){elem.classList.remove('hide');}else{elem.classList.add('hide');}});}else{if(listMainElem&&singleMenuElem){listMainElem.className='lm';singleMenuElem.className='hide';}
sliderIcons&&sliderIcons.forEach(function(elem){if(elem.classList.contains('hide')){elem.classList.remove('hide');}else{elem.classList.add('hide');}});}}):null;var navCollapseBtn=document.getElementById('navCollapseBtn');navCollapseBtn?navCollapseBtn.addEventListener('click',function(e){var navCollapse=document.querySelector('.navbar__collapse');if(navCollapse){var dataOpen=navCollapse.getAttribute('data-open');if(dataOpen==='true'){navCollapse.setAttribute('data-open','false');navCollapse.style.maxHeight=0;}else{navCollapse.setAttribute('data-open','true');navCollapse.style.maxHeight=navCollapse.scrollHeight+"px";}}}):null;var expandBtn=document.querySelectorAll('.expand__button');for(let i=0;i<expandBtn.length;i++){expandBtn[i].addEventListener("click",function(){var content=this.nextElementSibling;if(content.style.maxHeight){content.style.maxHeight=null;this.querySelector('svg').classList.add('expand-icon__right');this.querySelector('svg').classList.remove('expand-icon__down');}else{content.style.maxHeight=content.scrollHeight+"px";this.querySelector('svg').classList.remove('expand-icon__right');this.querySelector('svg').classList.add('expand-icon__down');}});}
document.querySelectorAll('.tab')?document.querySelectorAll('.tab').forEach(function(elem,idx){var containerId=elem.getAttribute('id');var containerElem=elem;var tabLinks=elem.querySelectorAll('.tab__link');var tabContents=elem.querySelectorAll('.tab__content');var ids=[];tabLinks&&tabLinks.length>0?tabLinks.forEach(function(link,index,self){link.onclick=function(e){for(var i=0;i<self.length;i++){if(index===parseInt(i,10)){if(!self[i].classList.contains('active')){self[i].classList.add('active');tabContents[i].style.display='block';}}else{self[i].classList.remove('active');tabContents[i].style.display='none';}}}}):null;}):null;document.querySelectorAll('.codetab')?document.querySelectorAll('.codetab').forEach(function(elem,idx){var containerId=elem.getAttribute('id');var containerElem=elem;var codetabLinks=elem.querySelectorAll('.codetab__link');var codetabContents=elem.querySelectorAll('.codetab__content');var ids=[];codetabLinks&&codetabLinks.length>0?codetabLinks.forEach(function(link,index,self){link.onclick=function(e){for(var i=0;i<self.length;i++){if(index===parseInt(i,10)){if(!self[i].classList.contains('active')){self[i].classList.add('active');codetabContents[i].style.display='block';}}else{self[i].classList.remove('active');codetabContents[i].style.display='none';}}}}):null;}):null;var enableDarkMode=JSON.parse("true");var root=document.getElementById('root');var toggleToLightBtn=document.getElementById('toggleToLight');var toggleToDarkBtn=document.getElementById('toggleToDark');if(!enableDarkMode){root.className='theme__light';localStorage.setItem('theme','light');}
if(toggleToDarkBtn){toggleToDarkBtn.onclick=function(e){root.className='theme__dark';localStorage.setItem('theme','dark');toggleToLightBtn.className='navbar__icons--icon';toggleToDarkBtn.className='hide';}}
if(toggleToLightBtn){toggleToLightBtn.onclick=function(e){root.className='theme__light';localStorage.setItem('theme','light');toggleToLightBtn.className='hide';toggleToDarkBtn.className='navbar__icons--icon';}}
document.querySelectorAll('.menu__list').forEach(function(elem){if(elem.classList.contains('active')){elem.style.maxHeight=elem.scrollHeight+"px";}});document.querySelectorAll('.menu__title--collapse').forEach(function(elem){elem.addEventListener('click',function(e){var content=this.nextElementSibling;var menuTitleIcon=this.querySelector('.menu__title--icon');if(!content){return null;}
var parent=elem.parentNode;while(parent.classList.contains('menu__list')&&parent.classList.contains('active')){parent.style.maxHeight=100*parent.children.length+"px";parent=parent.parentNode;}
if(content.style.maxHeight){content.style.maxHeight=null;content.classList.remove('active');menuTitleIcon.classList.add('right');if(languagedir==='rtl'){menuTitleIcon.classList.remove('downrtl');}else{menuTitleIcon.classList.remove('down');}}else{content.style.maxHeight=content.scrollHeight+"px";content.classList.add('active');menuTitleIcon.classList.remove('right');if(languagedir==='rtl'){menuTitleIcon.classList.add('downrtl');}else{menuTitleIcon.classList.add('down');}}});});var mobileLogo=document.getElementById('mobileLogo');var modal=document.getElementById("myModal");var drawer=document.getElementById('myDrawer');var drawerCloseBtn=document.querySelector('.drawer__close');var openDrawer=function(){modal.style.opacity=1;if(languagedir==='rtl'){modal.style.right=0;drawer.style.right=0;}else{modal.style.left=0;drawer.style.left=0;}}
var closeDrawer=function(){modal.style.opacity=0;if(languagedir==='rtl'){drawer.style.right='-100%';}else{drawer.style.left='-100%';}
setTimeout(function(){if(languagedir==='rtl'){modal.style.right='-100%';}else{modal.style.left='-100%';}},250);}
mobileLogo.onclick=function(){openDrawer();localStorage.setItem('isDrawerOpen','true');}
modal.onclick=function(){closeDrawer();localStorage.setItem('isDrawerOpen','false');}
drawerCloseBtn.onclick=function(){closeDrawer();localStorage.setItem('isDrawerOpen','false');}
var lastScrollTop=window.pageYOffset||document.documentElement.scrollTop;var tocElem=document.querySelector('.toc');var tableOfContentsElem=tocElem?tocElem.querySelector('#TableOfContents'):null;var singleContentsElem=document.querySelector('.single__contents');var dataBGImgs=document.querySelectorAll('div[data-bgimg]');var tocLevels=JSON.parse("[\"h1\",\"h2\",\"h3\",\"h4\"]");if(tocLevels){tocLevels=tocLevels.toString();}else{tocLevels="h1, h2, h3, h4, h5, h6";}
var isLandingBgImg=JSON.parse("null");var isHome=JSON.parse("false");function setNavbarBG(scrollTop){if(isHome&&isLandingBgImg&&Object.keys(isLandingBgImg).length){if(isLandingBgImg.height<=scrollTop){dataBGImgs.forEach(function(elem){elem.setAttribute('data-bgimg','false');});}else{dataBGImgs.forEach(function(elem){elem.setAttribute('data-bgimg','true');});}}}
setNavbarBG(lastScrollTop);window.onscroll=function(){var st=window.pageYOffset||document.documentElement.scrollTop;if(st>lastScrollTop){singleContentsElem?singleContentsElem.querySelectorAll(tocLevels.toString()).forEach(function(elem){if(document.documentElement.scrollTop>=elem.offsetTop){if(tableOfContentsElem){var id=elem.getAttribute('id');tocElem.querySelectorAll('a').forEach(function(elem){elem.classList.remove('active');});tocElem.querySelector('a[href="#'+id+'"]')?tocElem.querySelector('a[href="#'+id+'"]').classList.add('active'):null;}}}):null;setNavbarBG(st);}else{singleContentsElem?singleContentsElem.querySelectorAll(tocLevels.toString()).forEach(function(elem){if(document.documentElement.scrollTop>=elem.offsetTop){if(tableOfContentsElem){var id=elem.getAttribute('id');tocElem.querySelectorAll('a').forEach(function(elem){elem.classList.remove('active');});tocElem.querySelector('a[href="#'+id+'"]')?tocElem.querySelector('a[href="#'+id+'"]').classList.add('active'):null;}}}):null;setNavbarBG(st);}
lastScrollTop=st<=0?0:st;};var mobileSearchInputElem=document.querySelector('#search-mobile');var mobileSearchClassElem=document.querySelector('.mobile-search');var mobileSearchBtnElem=document.querySelector('#mobileSearchBtn');var mobileSearchCloseBtnElem=document.querySelector('#search-mobile-close');var mobileSearchContainer=document.querySelector('#search-mobile-container');var mobileSearchResultsElem=document.querySelector('#search-mobile-results');var htmlElem=document.querySelector('html');if(mobileSearchClassElem){mobileSearchClassElem.style.display='none';}
mobileSearchBtnElem?mobileSearchBtnElem.addEventListener('click',function(){if(mobileSearchContainer){mobileSearchContainer.style.display='block';}
if(mobileSearchInputElem){mobileSearchInputElem.focus();}
if(htmlElem){htmlElem.style.overflowY='hidden';}}):null;mobileSearchCloseBtnElem?mobileSearchCloseBtnElem.addEventListener('click',function(){if(mobileSearchContainer){mobileSearchContainer.style.display='none';}
if(mobileSearchInputElem){mobileSearchInputElem.value='';}
if(mobileSearchResultsElem){while(mobileSearchResultsElem.firstChild){mobileSearchResultsElem.removeChild(mobileSearchResultsElem.firstChild);}}
if(htmlElem){htmlElem.style.overflowY='visible';}}):null;mobileSearchInputElem?mobileSearchInputElem.addEventListener('keydown',function(e){if(e.key==='Escape'){if(mobileSearchContainer){mobileSearchContainer.style.display='none';}
if(mobileSearchInputElem){mobileSearchInputElem.value='';}
if(mobileSearchResultsElem){while(mobileSearchResultsElem.firstChild){mobileSearchResultsElem.removeChild(mobileSearchResultsElem.firstChild);}}
if(htmlElem){htmlElem.style.overflowY='visible';}}}):null;var localTheme=localStorage.getItem('theme');var rootEleme=document.getElementById('root');var selectThemeElem=document.querySelectorAll('.select-theme');var selectThemeItemElem=document.querySelectorAll('.select-theme__item');if(localTheme){selectThemeItemElem?selectThemeItemElem.forEach(function(elem){if(elem.text.trim()===localTheme){elem.classList.add('is-active');}else{elem.classList.remove('is-active');}}):null;}
selectThemeItemElem?selectThemeItemElem.forEach(function(v,i){v.addEventListener('click',function(e){var selectedThemeVariant=e.target.text.trim();localStorage.setItem('theme',selectedThemeVariant);rootEleme.removeAttribute('class');rootEleme.classList.add(`theme__${selectedThemeVariant}`);selectThemeElem.forEach(function(rootElem){rootElem.querySelectorAll('a').forEach(function(elem){if(elem.classList){if(elem.text.trim()===selectedThemeVariant){if(!elem.classList.contains('is-active')){elem.classList.add('is-active');}}else{if(elem.classList.contains('is-active')){elem.classList.remove('is-active');}}}});});if(window.mermaid){if(selectedThemeVariant==="dark"||selectedThemeVariant==="hacker"){mermaid.initialize({theme:'dark'});location.reload();}else{mermaid.initialize({theme:'default'});location.reload();}}
var utterances=document.querySelector('iframe');if(utterances){utterances.contentWindow.postMessage({type:'set-theme',theme:selectedThemeVariant==="dark"||selectedThemeVariant==="hacker"?'photon-dark':selectedThemeVariant==='kimbie'?'github-dark-orange':'github-light',},'https://utteranc.es');}});}):null;var langprefix=JSON.parse("\"\"");var searchResults=null;var searchMenu=null;var searchText=null;var enableSearchHighlight=JSON.parse("true");var enableSearch=JSON.parse("true");var fuse=null;if(enableSearch){(function initFuse(){var xhr=new XMLHttpRequest();xhr.open('GET',baseurl+langprefix+"/index.json");xhr.setRequestHeader('Content-Type','application/json; charset=utf-8');xhr.onload=function(){if(xhr.status===200){fuse=new Fuse(JSON.parse(xhr.response.toString('utf-8')),{keys:['title','description','content'],includeMatches:enableSearchHighlight,shouldSort:true,threshold:0.4,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,});}
else{console.error(`[${xhr.status}]Error:`,xhr.statusText);}};xhr.send();})();}
function makeLi(ulElem,obj){var li=document.createElement('li');li.className='search-result__item';var a=document.createElement('a');a.innerHTML=obj.title;a.setAttribute('class','search-result__item--title');a.setAttribute('href',obj.permalink);var descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');if(obj.description){descDiv.innerHTML=obj.description;}else if(obj.content){descDiv.innerHTML=obj.content.substring(0,80);}
li.appendChild(a);li.appendChild(descDiv);ulElem.appendChild(li);}
function makeHighlightLi(ulElem,obj){var li=document.createElement('li');li.className='search-result__item';var descDiv=null;var a=document.createElement('a');a.innerHTML=obj.item.title;a.setAttribute('class','search-result__item--title');a.setAttribute('href',obj.item.uri);if(obj.matches&&obj.matches.length){for(var i=0;i<obj.matches.length;i++){if('title'===obj.matches[i].key){a=document.createElement('a');a.innerHTML=generateHighlightedText(obj.matches[i].value,obj.matches[i].indices);a.setAttribute('class','search-result__item--title');a.setAttribute('href',obj.item.uri);}
if('description'===obj.matches[i].key){descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');descDiv.innerHTML=generateHighlightedText(obj.item.description,obj.matches[i].indices);}else if('content'===obj.matches[i].key){if(!descDiv){descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');descDiv.innerHTML=generateHighlightedText(obj.item.content.substring(0,80),obj.matches[i].indices);}}else{if(obj.item.description){descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');descDiv.innerHTML=obj.item.description;}else{descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');descDiv.innerHTML=obj.item.content.substring(0,80);}}}
li.appendChild(a);if(descDiv){li.appendChild(descDiv);}
if(li){ulElem.appendChild(li);}}}
function renderSearchResults(searchText,results){searchResults=document.getElementById('search-results');searchMenu=document.getElementById('search-menu');searchResults.setAttribute('class','dd is-active');var ul=document.createElement('ul');ul.setAttribute('class','dd-content search-content');if(results.length){results.forEach(function(result){var li=document.createElement('li');var a=document.createElement('a');a.setAttribute('href',result.uri);a.setAttribute('class','dd-item');a.appendChild(li);var titleDiv=document.createElement('div');titleDiv.innerHTML=result.title;titleDiv.setAttribute('class','search-result__item--title');var descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');if(result.description){descDiv.innerHTML=result.description;}else if(result.content){descDiv.innerHTML=result.content.substring(0,80);}
li.appendChild(titleDiv);li.appendChild(descDiv);ul.appendChild(a);});}else{var li=document.createElement('li');li.setAttribute('class','dd-item');li.innerText='No results found';ul.appendChild(li);}
while(searchMenu.hasChildNodes()){searchMenu.removeChild(searchMenu.lastChild);}
searchMenu.appendChild(ul);}
function renderSearchHighlightResults(searchText,results){searchResults=document.getElementById('search-results');searchMenu=document.getElementById('search-menu');searchResults.setAttribute('class','dd is-active');var ul=document.createElement('ul');ul.setAttribute('class','dd-content search-content');if(results.length){results.forEach(function(result){var li=document.createElement('li');var a=document.createElement('a');var descDiv=null;a.setAttribute('href',result.item.uri);a.setAttribute('class','dd-item');a.appendChild(li);var titleDiv=document.createElement('div');titleDiv.innerHTML=result.item.title;titleDiv.setAttribute('class','search-result__item--title');if(result.matches&&result.matches.length){for(var i=0;i<result.matches.length;i++){if('title'===result.matches[i].key){titleDiv.innerHTML=generateHighlightedText(result.matches[i].value,result.matches[i].indices);}
if('description'===result.matches[i].key){descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');descDiv.innerHTML=generateHighlightedText(result.item.description,result.matches[i].indices);}else if('content'===result.matches[i].key){if(!descDiv){descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');descDiv.innerHTML=generateHighlightedText(result.item.content.substring(0,80),result.matches[i].indices);}}else{if(result.item.description){descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');descDiv.innerHTML=result.item.description;}else{descDiv=document.createElement('div');descDiv.setAttribute('class','search-result__item--desc');descDiv.innerHTML=result.item.content.substring(0,80);}}}
li.appendChild(titleDiv);if(descDiv){li.appendChild(descDiv);}
ul.appendChild(a);}});}else{var li=document.createElement('li');li.setAttribute('class','dd-item');li.innerText='No results found';ul.appendChild(li);}
while(searchMenu.hasChildNodes()){searchMenu.removeChild(searchMenu.lastChild);}
searchMenu.appendChild(ul);}
function renderSearchResultsMobile(searchText,results){searchResults=document.getElementById('search-mobile-results');var content=document.createElement('div');content.setAttribute('class','mobile-search__content');if(results.length>0){results.forEach(function(result){var item=document.createElement('a');item.setAttribute('href',result.uri);item.innerHTML='<div class="mobile-search__item"><div class="mobile-search__item--title">ðŸ“„ '+result.title+'</div><div class="mobile-search__item--desc">'+(result.description?result.description:result.content)+'</div></div>';content.appendChild(item);});}else{var item=document.createElement('span');content.appendChild(item);}
let wrap=document.getElementById('search-mobile-results');while(wrap.firstChild){wrap.removeChild(wrap.firstChild)}
searchResults.appendChild(content);}
function renderSearchHighlightResultsMobile(searchText,results){searchResults=document.getElementById('search-mobile-results');var ul=document.createElement('div');ul.setAttribute('class','mobile-search__content');if(results.length){results.forEach(function(result){var li=document.createElement('li');var a=document.createElement('a');var descDiv=null;a.setAttribute('href',result.item.uri);a.appendChild(li);li.setAttribute('class','mobile-search__item');var titleDiv=document.createElement('div');titleDiv.innerHTML=result.item.title;titleDiv.setAttribute('class','mobile-search__item--title');if(result.matches&&result.matches.length){for(var i=0;i<result.matches.length;i++){if('title'===result.matches[i].key){titleDiv.innerHTML=generateHighlightedText(result.matches[i].value,result.matches[i].indices);}
if('description'===result.matches[i].key){descDiv=document.createElement('div');descDiv.setAttribute('class','mobile-search__item--desc');descDiv.innerHTML=generateHighlightedText(result.item.description,result.matches[i].indices);}else if('content'===result.matches[i].key){if(!descDiv){descDiv=document.createElement('div');descDiv.setAttribute('class','mobile-search__item--desc');descDiv.innerHTML=generateHighlightedText(result.item.content.substring(0,150),result.matches[i].indices);}}else{if(result.item.description){descDiv=document.createElement('div');descDiv.setAttribute('class','mobile-search__item--desc');descDiv.innerHTML=result.item.description;}else{descDiv=document.createElement('div');descDiv.setAttribute('class','mobile-search__item--desc');descDiv.innerHTML=result.item.content.substring(0,150);}}}
li.appendChild(titleDiv);if(descDiv){li.appendChild(descDiv);}
ul.appendChild(a);}});}else{var item=document.createElement('span');ul.appendChild(item);}
let wrap=document.getElementById('search-mobile-results');while(wrap.firstChild){wrap.removeChild(wrap.firstChild)}
searchResults.appendChild(ul);}
function generateHighlightedText(text,regions){if(!regions){return text;}
var content='',nextUnhighlightedRegionStartingIndex=0;regions.forEach(function(region){if(region[0]===region[1]){return null;}
content+=''+
text.substring(nextUnhighlightedRegionStartingIndex,region[0])+
'<span class="search__highlight">'+
text.substring(region[0],region[1]+1)+
'</span>'+
'';nextUnhighlightedRegionStartingIndex=region[1]+1;});content+=text.substring(nextUnhighlightedRegionStartingIndex);return content;};var searchElem=document.getElementById('search');var searchMobile=document.getElementById('search-mobile');var searchResultsContainer=document.getElementById('search-results');searchElem?searchElem.addEventListener('input',function(e){if(!e.target.value|window.innerWidth<770){searchResultsContainer?searchResultsContainer.setAttribute('class','dd'):null;return null;}
searchText=e.target.value;var results=fuse.search(e.target.value);if(enableSearchHighlight){renderSearchHighlightResults(searchText,results);}else{renderSearchResults(searchText,results);}
var dropdownItems=searchResultsContainer.querySelectorAll('.dd-item');dropdownItems?dropdownItems.forEach(function(item){item.addEventListener('mousedown',function(e){e.target.click();});}):null;}):null;searchElem?searchElem.addEventListener('blur',function(){if(window.innerWidth<770){return null;}
searchResultsContainer?searchResultsContainer.setAttribute('class','dd'):null;}):null;searchElem?searchElem.addEventListener('click',function(e){if(window.innerWidth<770){return null;}
if(!e.target.value){searchResultsContainer?searchResultsContainer.setAttribute('class','dd'):null;return null;}
searchText=e.target.value;var results=fuse.search(e.target.value);if(enableSearchHighlight){renderSearchHighlightResults(searchText,results);}else{renderSearchResults(searchText,results);}
var dropdownItems=searchResultsContainer.querySelectorAll('.dd-item');dropdownItems?dropdownItems.forEach(function(item){item.addEventListener('mousedown',function(e){e.target.click();});}):null;}):null;var searchMenuElem=document.getElementById("search-menu");var activeItem=document.querySelector('#search-menu .dd-item.is-active');var activeIndex=null;var items=null;var searchContainerMaxHeight=350;searchElem?searchElem.addEventListener('keydown',function(e){if(window.innerWidth<770){return null;}
var items=document.querySelectorAll('#search-menu .dd-item');if(e.key==='ArrowDown'){if(activeIndex===null){activeIndex=0;items[activeIndex].classList.remove('is-active');}else{items[activeIndex].classList.remove('is-active');activeIndex=activeIndex===items.length-1?0:activeIndex+1;}
items[activeIndex].classList.add('is-active');let overflowedPixel=items[activeIndex].offsetTop+items[activeIndex].clientHeight-searchContainerMaxHeight;if(overflowedPixel>0){document.querySelector(".search-content").scrollTop+=items[activeIndex].getBoundingClientRect().height;}else if(activeIndex===0){document.querySelector(".search-content").scrollTop=0;}}else if(e.key==='ArrowUp'){if(activeIndex===null){activeIndex=items.length-1;items[activeIndex].classList.remove('is-active');}else{items[activeIndex].classList.remove('is-active');activeIndex=activeIndex===0?items.length-1:activeIndex-1;}
items[activeIndex].classList.add('is-active');let overflowedPixel=items[activeIndex].offsetTop+items[activeIndex].clientHeight-searchContainerMaxHeight;if(overflowedPixel<0){document.querySelector(".search-content").scrollTop-=items[activeIndex].getBoundingClientRect().height;}else{document.querySelector(".search-content").scrollTop=overflowedPixel+items[activeIndex].getBoundingClientRect().height;}}else if(e.key==='Enter'){var currentItemLink=items[activeIndex].getAttribute('href');if(currentItemLink){location.href=currentItemLink;}}else if(e.key==='Escape'){e.target.value=null;if(searchResults){searchResults.classList.remove('is-active');}}}):null;searchMobile?searchMobile.addEventListener('input',function(e){if(!e.target.value){let wrap=document.getElementById('search-mobile-results');while(wrap.firstChild){wrap.removeChild(wrap.firstChild);}
return null;}
searchText=e.target.value;var results=fuse.search(e.target.value);if(enableSearchHighlight){renderSearchHighlightResultsMobile(searchText,results);}else{renderSearchResultsMobile(searchText,results);}
var dropdownItems=searchResultsContainer.querySelectorAll('.dd-item');dropdownItems?dropdownItems.forEach(function(item){item.addEventListener('mousedown',function(e){e.target.click();});}):null;}):null;}</script><link rel=stylesheet href=/css/main.min.css><meta name=description content="Contains Notes for the book Java concurrency in practice - https://jcip.net/)"><meta name=keywords content><meta name=created content="2022-11-24T10:39:40-0800"><meta name=modified content="2022-11-24T10:39:40-0800"><meta property="og:site_name" content="Akrishna"><meta property="og:title" content="Ch01 - Thread Safety"><meta property="og:url" content="https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/"><meta property="og:type" content="article"><meta property="og:image" content="https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/jcip.png"><meta name=generator content="Hugo 0.77.0"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><link rel=canonical href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><link rel=manifest href=/manifest.json><link rel=apple-touch-icon sizes=57x57 href=/favicon/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/favicon/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/favicon/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/favicon/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/favicon/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/favicon/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/favicon/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/favicon/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-icon-180x180.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-192x192.png><link rel=icon type=image/png sizes=192x192 href=/favicon/android-icon-512x512.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon/favicon-96x96.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><meta name=msapplication-TileColor content="#ffffff"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","headline":"Ch01 - Thread Safety","datePublished":"2022-11-24T10:39:40-08:00","dateModified":"2022-11-24T10:39:40-08:00","url":"https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/","description":"Contains Notes for the book Java concurrency in practice - https://jcip.net/)","image":"https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/jcip.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://adhithyakrishna.github.io/"},"publisher":{"@type":"Organization","name":"Akrishna","url":"https://adhithyakrishna.github.io/"}}</script></head><body id=root class=theme__dark><script>var rootElem=document.getElementById('root');var themeOptions=JSON.parse("[\"dark\",\"light\"]");var localTheme=localStorage.getItem('theme');if(localTheme){if(themeOptions&&themeOptions.length>0){themeOptions.includes(localTheme)?rootElem.className=`theme__${localTheme}`:rootElem.className=`theme__${themeOptions[0]}`;}}</script><div id=container><div id=myDrawer class=drawer><div class=drawer__header><a href=/ class=drawer__header--text>Akrishna</a><div class=grow></div><div class=drawer__close><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentcolor" d="M18.3 5.71c-.39-.39-1.02-.39-1.41.0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41.0s-.39 1.02.0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02.0 1.41s1.02.39 1.41.0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41.0s.39-1.02.0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02.0-1.4z"/></svg></div></div><div class=drawer__body><div class=menu><h6 class=menu__label>Ch01 - Thread Safety</h6><ul><li class="menu__title--collapse active" data-depth=0 data-permalink=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/><span class=menu__title--collapse-text>Java concurrency in practice</span>
<span class="menu__title--icon down"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg></span></li><ul class="menu__list active" data-data=/java_concurrency_in_practice/ data-link=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><li class=menu__title--collapse data-depth=1 data-permalink=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/introduction/><span class=menu__title--collapse-text>Introduction</span>
<span class="menu__title--icon right"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg></span></li><ul class=menu__list data-data=/introduction/ data-link=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/introduction/introduction/ class=menu__title data-depth=1>Ch01 - Introduction</a></li><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/introduction/benefits_of_threads/ class=menu__title data-depth=1>Ch02 - Benefits of Threads</a></li><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/introduction/risks_of_threads/ class=menu__title data-depth=1>Ch03 - Risks of threads</a></li></ul><li class="menu__title--collapse active" data-depth=1 data-permalink=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/><span class=menu__title--collapse-text>Fundamentals</span>
<span class="menu__title--icon down"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg></span></li><ul class="menu__list active" data-data=/fundamentals/ data-link=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/ class="menu__title active" data-depth=1>Ch01 - Thread Safety</a></li></ul></ul><li class=menu__title--collapse data-depth=0 data-permalink=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/><span class=menu__title--collapse-text>Kubernetes for absolute beginners</span>
<span class="menu__title--icon right"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg></span></li><ul class=menu__list data-data=/k8s_for_absolute_beginners/ data-link=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/introduction/ class=menu__title data-depth=0>Introduction</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/k8s_architecture/ class=menu__title data-depth=0>Kubernetes architecture</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/yaml_introduction/ class=menu__title data-depth=0>Yaml Introduction</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/yaml_for_k8s/ class=menu__title data-depth=0>Yaml for Kubernetes</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/k8s_controllers/ class=menu__title data-depth=0>Kubernetes controllers</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/k8s_services/ class=menu__title data-depth=0>Kubernetes services</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/k8s_pods_demo/ class=menu__title data-depth=0>Demo - Voting application 1</a></li></ul></ul></div><script>var menuTitle=document.querySelectorAll('.menu__title');var modal=document.getElementById("myModal");var drawer=document.getElementById('myDrawer');var closeDrawer=function(){setTimeout(function(){modal.style.opacity=0;drawer.style.left='-100%';modal.style.left='-100%';},250);}
menuTitle?menuTitle.forEach(function(elem){elem.onclick=function(){closeDrawer();localStorage.setItem('isDrawerOpen','false');}}):null;</script></div></div><div id=myModal class=modal></div><script>var isDrawerOpen=localStorage.getItem('isDrawerOpen');var modal=document.getElementById("myModal");var drawer=document.getElementById('myDrawer');var languagedir=JSON.parse("\"ltr\"");var openDrawer=function(){modal.style.opacity=1;if(languagedir==="rtl"){modal.style.right=0;drawer.style.right=0;}else{modal.style.left=0;drawer.style.left=0;}}
if(isDrawerOpen&&isDrawerOpen==='true'){openDrawer();}</script><nav class=nav><div class=navbar__wrapper data-bgimg=false><div class=divider><div class="navbar lmr"><div id=siteLogo class=navbar__logo--wrapper><a href=/ rel=home class=navbar__logo--link><img src=/logo.png alt=Home class=navbar__logo></a>
<a href=/ rel=home class=navbar__logo--text-link><h6 class=navbar__logo--text data-bgimg=false>Akrishna</h6></a></div><div class=navbar__menu--wrapper><div id=tabletLogo class=hide><a href=/ rel=home class=navbar__logo--link><img src=/logo.png alt=Home class=navbar__logo></a></div><div id=mobileLogo class=hide><a href=# class=navbar__logo--link><div class=navbar__icons--icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentcolor" d="M4 18h16c.55.0 1-.45 1-1s-.45-1-1-1H4c-.55.0-1 .45-1 1s.45 1 1 1zm0-5h16c.55.0 1-.45 1-1s-.45-1-1-1H4c-.55.0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55.0 1-.45 1-1s-.45-1-1-1H4c-.55.0-1 .45-1 1z"/></svg></div></a></div><span id=navMenuMobile class=hide><button id=navCollapseBtn class=navbar__dropdown--title aria-label="Section Menu" data-dir=ltr>
notes<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentcolor" d="M8.12 9.29 12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41.0s.39 1.02.0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41.0L6.7 10.7c-.39-.39-.39-1.02.0-1.41.39-.38 1.03-.39 1.42.0z"/></svg></button><div class=navbar__collapse data-open=false><ul><li class=navbar__menu--mobile-item><a href=/articles>Articles</a></li><li class="navbar__menu--mobile-item active"><a href=/notes class=active>Notes</a></li><li class=navbar__menu--mobile-item><a href=/blog>Blog</a></li></ul></div></span><ul id=navMenu class=navbar__menu><li class=navbar__menu--item><a href=/articles data-bgimg=false>Articles</a></li><li class="navbar__menu--item active"><a href=/notes data-bgimg=false>Notes</a></li><li class=navbar__menu--item><a href=/blog data-bgimg=false>Blog</a></li></ul></div><div class=grow></div><div id=siteSearch><div class=search data-bgimg=false><span class=icon><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentcolor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49.0s.41-1.08.0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></span><input id=search aria-label="Site Search" class=input type=text autocomplete=off placeholder=Search><div id=search-results class=dropdown><div id=search-menu class=dropdown-menu></div></div></div></div><div id=mobileSearch class=hide><div id=mobileSearchBtn class=mobile-search__btn><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentcolor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49.0s.41-1.08.0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></div><div id=search-mobile-container class="mobile-search hide"><div class=mobile-search__top><input id=search-mobile type=text aria-label="Mobile Search" placeholder=Search... class=mobile-search__top--input><div id=search-mobile-close class=mobile-search__top--icon><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path opacity=".87" fill="none" d="M0 0h24v24H0V0z"/><path fill="currentcolor" d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41.0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"/></svg></div></div><div id=search-mobile-results class=mobile-search__body></div></div></div><div class=navbar__icons><button id=toggleToDark class=navbar__icons--icon aria-label="Toggle to dark mode"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path fill="currentcolor" d="M20 15.31 23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31.0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/></svg></button>
<button id=toggleToLight class=navbar__icons--icon aria-label="Toggle to light mode"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path fill="currentcolor" d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31.0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21.0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"/></svg></button>
<script>var theme=localStorage.getItem('theme');var toggleToLightBtn=document.getElementById('toggleToLight');var toggleToDarkBtn=document.getElementById('toggleToDark');if(theme&&theme==='dark'){toggleToLightBtn.className='navbar__icons--icon';toggleToDarkBtn.className='hide';}else{toggleToLightBtn.className='hide';toggleToDarkBtn.className='navbar__icons--icon';}</script><div class=navbar__icons--icon><a href=https://github.com/adhithyakrishna title="Github repository" aria-label="Github repository" target=_blank rel=noreferrer><svg fill="currentcolor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22"><path d="M10.9 2.1c-4.6.5-8.3 4.2-8.8 8.7-.5 4.7 2.2 8.9 6.3 10.5C8.7 21.4 9 21.2 9 20.8v-1.6s-.4.1-.9.1c-1.4.0-2-1.2-2.1-1.9-.1-.4-.3-.7-.6-1C5.1 16.3 5 16.3 5 16.2 5 16 5.3 16 5.4 16c.6.0 1.1.7 1.3 1 .5.8 1.1 1 1.4 1 .4.0.7-.1.9-.2.1-.7.4-1.4 1-1.8-2.3-.5-4-1.8-4-4 0-1.1.5-2.2 1.2-3C7.1 8.8 7 8.3 7 7.6c0-.4.0-.9.2-1.3C7.2 6.1 7.4 6 7.5 6h.1C8.1 6.1 9.1 6.4 10 7.3 10.6 7.1 11.3 7 12 7s1.4.1 2 .3c.9-.9 2-1.2 2.5-1.3h.1c.2.0.3.1.4.3C17 6.7 17 7.2 17 7.6c0 .8-.1 1.2-.2 1.4.7.8 1.2 1.8 1.2 3 0 2.2-1.7 3.5-4 4 .6.5 1 1.4 1 2.3v2.6c0 .3.3.6.7.5 3.7-1.5 6.3-5.1 6.3-9.3C22 6.1 16.9 1.4 10.9 2.1z"/></svg></a></div></div></div></div></div></nav><script>var siteLogo=document.getElementById('siteLogo');var tabletLogo=document.getElementById('tabletLogo');var mobileLogo=document.getElementById('mobileLogo');var navMenu=document.getElementById('navMenu');var navMenuMobile=document.getElementById('navMenuMobile');var siteSearch=document.getElementById('siteSearch');var mobileSearch=document.getElementById('mobileSearch');enquire.register("screen and (max-width:1280px)",{match:function(){siteLogo.className='navbar__logo--wrapper';tabletLogo.className='hide';mobileLogo.className='hide';navMenu.className='navbar__menu';navMenuMobile.className='hide';siteSearch.className='';mobileSearch.className='hide';},unmatch:function(){siteLogo.className='navbar__logo--wrapper';tabletLogo.className='hide';mobileLogo.className='hide';navMenu.className='navbar__menu';navMenuMobile.className='hide';siteSearch.className='';mobileSearch.className='hide';},}).register("screen and (max-width:960px)",{match:function(){siteLogo.className='hide';tabletLogo.className='';mobileLogo.className='hide';navMenu.className='navbar__menu';navMenuMobile.className='hide';siteSearch.className='hide';mobileSearch.className='navbar__icons--icon';},unmatch:function(){siteLogo.className='navbar__logo--wrapper';tabletLogo.className='hide';mobileLogo.className='hide';navMenu.className='navbar__menu';navMenuMobile.className='hide';siteSearch.className='';mobileSearch.className='hide';},}).register("screen and (max-width:600px)",{match:function(){siteLogo.className='hide';tabletLogo.className='hide';mobileLogo.className='';navMenu.className='hide';navMenuMobile.className='';siteSearch.className='hide';mobileSearch.className='navbar__icons--icon';},unmatch:function(){siteLogo.className='hide';tabletLogo.className='';mobileLogo.className='hide';navMenu.className='navbar__menu';navMenuMobile.className='hide';siteSearch.className='hide';mobileSearch.className='navbar__icons--icon';},});</script><div class=top><div class="header__wrapper bgcolor__header"><div class=divider><div class=lmr><h2 class=title>Ch01 - Thread Safety</h2></div></div></div><div class="header__wrapper bgcolor__breadcrumb"><div class=divider><div class="lmr flexbox"><nav class=breadcrumb aria-label=breadcrumbs data-is-blog=false><ol><li><a href=https://adhithyakrishna.github.io/ class=capitalize>Adhithyakrishna</a></li><li><a href=https://adhithyakrishna.github.io/notes/ class=capitalize>Notes</a></li><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/ class=capitalize>Java concurrency in practice</a></li><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/ class=capitalize>Fundamentals</a></li><li class=is-active><span>Ch01 - Thread Safety</span></li></ol></nav><div class=grow></div><label class="switch switch__rel"><input id=toggle-sidebar aria-label="Toggle Sidebar Visibility" type=checkbox checked>
<span class=slider><span class=slider__icon><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentcolor" d="M5 13h11.17l-4.88 4.88c-.39.39-.39 1.03.0 1.42.39.39 1.02.39 1.41.0l6.59-6.59c.39-.39.39-1.02.0-1.41l-6.58-6.6c-.39-.39-1.02-.39-1.41.0s-.39 1.02.0 1.41L16.17 11H5c-.55.0-1 .45-1 1s.45 1 1 1z"/></svg></span><span class="slider__icon hide"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentcolor" d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03.0-1.42s-1.02-.39-1.41.0l-6.59 6.59c-.39.39-.39 1.02.0 1.41l6.59 6.59c.39.39 1.02.39 1.41.0s.39-1.02.0-1.41L7.83 13H19c.55.0 1-.45 1-1s-.45-1-1-1z"/></svg></span></span></label></div></div></div></div><div class=mid><div class=divider><nav id=single-menu class=l data-dir=ltr><div class=menu><h6 class=menu__label>Ch01 - Thread Safety</h6><ul><li class="menu__title--collapse active" data-depth=0 data-permalink=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/><span class=menu__title--collapse-text>Java concurrency in practice</span>
<span class="menu__title--icon down"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg></span></li><ul class="menu__list active" data-data=/java_concurrency_in_practice/ data-link=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><li class=menu__title--collapse data-depth=1 data-permalink=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/introduction/><span class=menu__title--collapse-text>Introduction</span>
<span class="menu__title--icon right"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg></span></li><ul class=menu__list data-data=/introduction/ data-link=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/introduction/introduction/ class=menu__title data-depth=1>Ch01 - Introduction</a></li><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/introduction/benefits_of_threads/ class=menu__title data-depth=1>Ch02 - Benefits of Threads</a></li><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/introduction/risks_of_threads/ class=menu__title data-depth=1>Ch03 - Risks of threads</a></li></ul><li class="menu__title--collapse active" data-depth=1 data-permalink=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/><span class=menu__title--collapse-text>Fundamentals</span>
<span class="menu__title--icon down"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg></span></li><ul class="menu__list active" data-data=/fundamentals/ data-link=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><li><a href=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/ class="menu__title active" data-depth=1>Ch01 - Thread Safety</a></li></ul></ul><li class=menu__title--collapse data-depth=0 data-permalink=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/><span class=menu__title--collapse-text>Kubernetes for absolute beginners</span>
<span class="menu__title--icon right"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="currentcolor" d="M9.29 15.88 13.17 12 9.29 8.12c-.39-.39-.39-1.02.0-1.41.39-.39 1.02-.39 1.41.0l4.59 4.59c.39.39.39 1.02.0 1.41L10.7 17.3c-.39.39-1.02.39-1.41.0-.38-.39-.39-1.03.0-1.42z"/></svg></span></li><ul class=menu__list data-data=/k8s_for_absolute_beginners/ data-link=https://adhithyakrishna.github.io/notes/java_concurrency_in_practice/fundamentals/thread_safety/><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/introduction/ class=menu__title data-depth=0>Introduction</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/k8s_architecture/ class=menu__title data-depth=0>Kubernetes architecture</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/yaml_introduction/ class=menu__title data-depth=0>Yaml Introduction</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/yaml_for_k8s/ class=menu__title data-depth=0>Yaml for Kubernetes</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/k8s_controllers/ class=menu__title data-depth=0>Kubernetes controllers</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/k8s_services/ class=menu__title data-depth=0>Kubernetes services</a></li><li><a href=https://adhithyakrishna.github.io/notes/k8s_for_absolute_beginners/k8s_pods_demo/ class=menu__title data-depth=0>Demo - Voting application 1</a></li></ul></ul></div></nav><article id=list-main class=m data-dir=ltr><div class=single data-display=block><article class=single__contents data-dir=ltr><div class=featured-image__wrapper><img src=/notes/java_concurrency_in_practice/jcip.png alt="Featured Image" class=featured-image style=width:;height:></div><p>Concurrency is more about achieving thread-safety, than it is about creating & managing threads. Those are mechanisms, but at its core, concurrency aims to encapsulate shared mutable state from uncontrolled concurrent access.</p><h4 id=state-of-an-object>State of an object</h4><p>An object&rsquo;s state encompasses any data that can affect its externally visible behavior. An object&rsquo;s state is its data, stored in state variables such as instance or static fields.<br>An object&rsquo;s state may include fields from other dependant objects. Example a <code>HashMap</code>&rsquo;s state is partially stored in the HashMap object itself, but also in many <code>Map.Entry</code> objects.</p><p><em><strong>Shared:</strong></em> Variable could be accessed by multiple threads.<br><em><strong>Mutable:</strong></em> Value could change during its lifetime.</p><h4 id=thread-safety>Thread safety</h4><p>Threadsafety is about trying to protect the data from uncontrolled concurrent access. Whether an object needs to be thread-safe depends on whether it will be accessed from multiple threads. This is a property of <em><strong>how an object is used in a program and not what it does</strong></em>.</p><p>Making an object thread-safe requires using <em><strong>synchronization</strong></em> to coordinate access to its mutable state. Failing to do so could result in <em><strong>data corruption and other undesirable consequences.</strong></em></p><p>When more than one thread accesses a given state variable and one of them might write to it, they all must coordinate their access to it using synchronization.</p><p>The primary mechanism for synchronization in Java is the <code>synchronized</code> keyword, which provides exclusive locking, but the term &lsquo;synchronization&rsquo; also includes the use of<br>1)<code>volatile</code> variables<br>2) Explicit locks<br>3) Atomic variables</p><div class=box>A program that omits the needed synchronization might <em><strong>appear to work</strong></em>, passing its test and performing well for years, but it is still broken and may fail at any moment.</div><div class=box><p>If multiple threads access the same mutable state variable without appropriate synchronization, the program is broken and there are three ways to fix it:</p><ol><li>Dont share the state variables across threads.</li><li>Make the state variable immutable.</li><li>Use synchronization whenever accessing the state variable.</li></ol></div><p>If it easier to design a class to be thread-safe than to retrofit it for thread safety later.</p><p>Object oriented techniques can help write well-organized, maintainable classes - such as encapsulation and data hiding - can also help create thread-safe classes.</p><p>Java does not force developers to encapsulate state - A state can be stored in public fields or public static fields or publish a reference to an otherwise internal object, but the better encapsulated the program state is, the easier it is to make the program thread-safe. The less code that has access to a particular variable, the easier it is to ensure that all of it uses proper synchronization.</p><div class=box><p>When designing thread-safe classes, good object-oriented techniques - encapasulation, immutability and clear specification of invariants are helpful.</p><p>Invariant means something that should stick to its conditions no matter whatever changes or whoever uses/transforms it.</p></div><p>There might be times when good OO design techniques are at odds with real-world requirements.</p><ol><li>Rules of good design need to be compromised for the sake of performance or for the same of backward compatability with legacy code.</li><li>Abstraction and Encapsulation are at odds with performance - (although not nearly as often).</li></ol><p>It is a good practice to make the code right and then make it fast. Pursue optimization only if needed and those same measurements tell you that your optimizations actually made a difference under realistic conditions.</p><p>A program that consists entirely of <code>thread-safe</code> classes may not be thread-safe. The concept of a thread-safe class makes sense only if the class encapsulates its own state.</p><div class=box>Thread safety may be a term that is applied to code, but it is about state, and it can be applied to the entire body of code that encapsulates its state, which may be an object or an entire program.</div><h4 id=what-is-thread-safety>What is Thread Safety?</h4><p>The heart of any reasonable definition of thread safety is its concept of <em><strong>correctness</strong></em>.</p><p>*<strong>Correctness</strong> means that a class conforms to its specification. A good specification defines invariants constraining an object&rsquo;s state and post - conditions describing the effects of its operations.</p><div class=box>A class is thread-safe if it behaves correctly when accessed from multiple threads, regardless of the scheduling or interleaving of the execution of those threads by the runtime enviornment, and with no additional synchronization or other coordination on the part of the calling code.</div><p>If an object is correctly implemented, no sequence of operations - calls to public methods and reads or writes of public fields - should be able to violate any of its invariants or post-conditions.<br>No set of operations performed sequentially or concurrently on instances of a thread-safe class can cause an instance to be an invalid state.</p><p>Frameworks like servlet frameworks create threads and call components from those threads, leaving developers with making the components thread-safe.</p><h5 id=stateless-servlet>Stateless servlet</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StatelessFactorizer</span> <span class=kd>implements</span> <span class=n>Servlet</span> <span class=o>{</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>BigInteger</span> <span class=n>i</span> <span class=o>=</span> <span class=n>extractFromRequest</span><span class=o>(</span><span class=n>req</span><span class=o>);</span>
    <span class=n>BigInteger</span><span class=o>[]</span> <span class=n>factors</span> <span class=o>=</span> <span class=n>factor</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
    <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>factors</span><span class=o>);</span>
  <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p><code>StatelessFactorizer</code> in the above example has no fields and references no fields from other classes.<br>The *<strong>transient state</strong> for a particular computation exists solely in local variables that are stored on <em><strong>thread&rsquo;s stack</strong></em> and are accessible only to the executing thread.</p><p>One thread accessing a <code>StatelessFactorizer</code> cannot influence the result of another thread accessing the same <code>StatelessFactorizer</code> because two threads do not share state. It is as if they were accessing different instances.</p><p>Since the actions of a thread accessing a stateless object cannot affect the correctness of operations in other threads, stateless objects are thread-safe.</p><div class=box>Stateless objects are always thread safe.</div><p>If its only when servlet wants to remember things from one request to another that the thread safety requirement becomes and issue.</p><h4 id=atomicity>Atomicity</h4><p>Adding one element of state to a stateless object would make it not thread-safe, even though it worked just fine in a single-threaded environment.</p><p>In this example, a variable <code>count</code> is introduced to keep track of the number of request processed. Though this may work just fine in a single threaded environment, it is susceptible to <em><strong>lost updates.</strong></em></p><p><code>count</code> variable as noted previously, despite its shorthand syntax has 3 discrete operations (read-modify-write operation).</p><ol><li>Fetch the current value.</li><li>Add one to it.</li><li>Write the new value back.</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UnsafeCountingFactorizer</span> <span class=kd>implements</span> <span class=n>Servlet</span> <span class=o>{</span>
  <span class=kd>private</span> <span class=kt>long</span> <span class=n>count</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
  <span class=kd>public</span> <span class=kt>long</span> <span class=nf>getCount</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>count</span><span class=o>;</span> <span class=o>}</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>BigInteger</span> <span class=n>i</span> <span class=o>=</span> <span class=n>extractFromRequest</span><span class=o>(</span><span class=n>req</span><span class=o>);</span>
    <span class=n>BigInteger</span><span class=o>[]</span> <span class=n>factors</span> <span class=o>=</span> <span class=n>factor</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
    <span class=o>++</span><span class=n>count</span><span class=o>;</span>
    <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>factors</span><span class=o>);</span>
  <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>If two threads increment the counter simultaneously, without synchronization, the counter would not give an accurate result. The posibility of incorrect results in the presence of unlucky timing is called a <em><strong>race condition.</strong></em></p><h4 id=race-conditions>Race conditions</h4><p>A race condition occurs when the correctness of the computation depends on lucky timing (relative timing or interleaving of multiple threads by runtime).</p><h5 id=check-then-act>check-then-act</h5><p><code>check-then-act</code> is a type of race condition that uses a potentially stale observation to make a decision or perform a computation. The observation could have even become invalid between the time it was observed and the time an action was take on it.</p><p>Example: Lazy intialization</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@NotThreadSafe</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LazyInitRace</span> <span class=o>{</span>
  <span class=kd>private</span> <span class=n>ExpensiveObject</span> <span class=n>instance</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
  <span class=kd>public</span> <span class=n>ExpensiveObject</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>
    <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ExpensiveObject</span><span class=o>();</span>
    <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
  <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>The goal of lazy initialization is to defer intializing an object until it is actually needed at the same time making sure that it is initialized only once.</p><p>The <code>getInstance()</code> method checks whether the expensive object has been initialized, in this case it returns the existing instance, otherwise it creates a new instance and returns it retaining a reference so that it can be used for future invocations (to avoid expensive code paths).</p><p>When two threads A and B execute <code>getInstance()</code> at the same time. &lsquo;A&rsquo; sees that instance is <code>null</code> and initiate a new object. &lsquo;B&rsquo; also checks if instance is null. The state of instance depends on</p><ol><li>Timing (which is unpredictable)</li><li>Vagaries of scheduling</li><li>How long A takes to initiate the <code>ExpensiveOject</code> and set the instance field.</li></ol><p>&lsquo;B&rsquo; may again initialize a new instance even though <code>getInstance()</code> was supposed to return the same instance.</p><p>Race conditions does not always result in failure but can cause serious problems. As an example, different instances from multiple invocatiosn could cause registrations to be lost or multiple activities to have inconsistent views of the set of registered objects.</p><h5 id=read-modify-write>read-modify-write</h5><p>As we saw previously <code>++count</code> is not an atomic operation. To properly increment the counter, the current thread must know its previous value and make sure no other thread is changing or using the value in the middle of the update.</p><h4 id=compounded-actions>Compounded Actions</h4><p>Both <code>read-modify-write</code> and <code>check-then-act</code> (collectively refered to as <em><strong>compound actions</strong></em>) contains a sequence of operations that need to be atomic or indivisible, relative to other operations on the same state (i.e) sequences of operations that must be executed atomically inorder to remain thread safe.</p><p>To avoid race conditions, there must be a way to prevent other threads from using a variable while we are in the middle of modifying it, so we can ensure that other threads can observer or modify the state only before we start or after we finish but not in the middle.</p><div class=box><p>An atomic operation is one that is atomic with respect to all operations, including itself, that operate on the same state.</p><p>Operations A and B are atomic with respect to each other if, from the perspective of a thread t1 executing operation A, when another thread t2 executes B, either all of B has executed or none of it has.</p></div><p>The <code>CountingFactorizer</code> can be made atomic by using <code>java.util.concurrent.atomic</code> package that contains atomic variable classes for effecting atomic state transition on numbers and object references.</p><p>By replacing the long counter with an <code>AtomicLong</code>, all actions that access the counter state are atomic. Because the <em><strong>state of the servlet is the state of the counter</strong></em> and the counter is <em><strong>thread-safe</strong></em> the servlet is once again thread-safe.</p><div class=box>Where practical, use existing thread-safe objects, like AtomicLong, to manage class&rsquo;s state. It is simpler to reason about the states and state transition for existing thread-safe objects than it is for arbitary state variables, and makes it easy to maintain and verify the thread safety.</div><h4 id=locking>Locking</h4><p>Adding one more thread-safe state variable to the class <em><strong>will not make it thread-safe</strong></em></p><p>The definition of thread safety requires that invariants be preserved regardless of timing or interleaving of operations in multiple threads.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UnsafeCachingFactorizer</span> <span class=kd>implements</span> <span class=n>Servlet</span> <span class=o>{</span>
 <span class=kd>private</span> <span class=kd>final</span> <span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>BigInteger</span><span class=o>&gt;</span> <span class=n>lastNumber</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>BigInteger</span><span class=o>&gt;();</span>
 <span class=kd>private</span> <span class=kd>final</span> <span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>BigInteger</span><span class=o>[]&gt;</span> <span class=n>lastFactors</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>BigInteger</span><span class=o>[]&gt;();</span>
 <span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=o>{</span>
  <span class=n>BigInteger</span> <span class=n>i</span> <span class=o>=</span> <span class=n>extractFromRequest</span><span class=o>(</span><span class=n>req</span><span class=o>);</span>
  <span class=k>if</span> <span class=o>(</span><span class=n>i</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>lastNumber</span><span class=o>.</span><span class=na>get</span><span class=o>()))</span>
    <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>lastFactors</span><span class=o>.</span><span class=na>get</span><span class=o>()</span> <span class=o>);</span>
  <span class=k>else</span> <span class=o>{</span>
    <span class=n>BigInteger</span><span class=o>[]</span> <span class=n>factors</span> <span class=o>=</span> <span class=n>factor</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
    <span class=n>lastNumber</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
    <span class=n>lastFactors</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>factors</span><span class=o>);</span>
    <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>factors</span><span class=o>);</span>
  <span class=o>}</span>
 <span class=o>}</span>
<span class=o>}</span> 
</code></pre></td></tr></table></div></div><p>The above example is responsible for improving the performance of the servlet by caching the most recently computed result, just in case two consecutive clients request factorization of the same number. To implement this, the last number factored and its factors needs to be remembered.</p><p>Using atomic references, both lastNumber and lastFactor cannot be updated simultaneously. Even though each call to set is atomic, there is still a window of vulnerability when one has been modified and the other has not, and during that time, other threads could see that the invariant does not hold. Similarly, two values cannot be fetched simultaneously, between the time when thread A fetches the two values, thread B could have changed them and again A may observe that the invariant does not hold.</p><div class=box>To preserve state consistency, update related state variables in a single atomic operation.</div><h4 id=reentrancy>Reentrancy</h4><p>Reentrancy means that locks are acquired on a per-thread rather than per invocation basis.<br>When a thread requests a lock that is already held by another thread, the requesting thread blocks. But since <em><strong>intrinsic</strong></em> locks are reentrant, if a thread tries to acquire a lock that it already holds, the request succeeds.<br>Reentrancy is implemented by associated each lock with an acquisition count and an owning thread.<br>When a thread acquires the lock (previously unheld lock) the JVM records the owner and sets the acqusition count to 1. If the same thread acquires the lock again, the count is incremented and when the <em><strong>owning thread exists the synchonrized block</strong></em> the count is decremented. When the counter becomes zero, the lock is released.</p><p>Reentrancy facilitates encapsulation of locking behavior and thus simplifies the development of object-oriented concurrent code.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Widget</span> <span class=o>{</span>
 <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>doSomething</span><span class=o>()</span> <span class=o>{</span>
 <span class=o>...</span>
 <span class=o>}</span>
<span class=o>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LoggingWidget</span> <span class=kd>extends</span> <span class=n>Widget</span> <span class=o>{</span>
 <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>doSomething</span><span class=o>()</span> <span class=o>{</span>
 <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>toString</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;: calling doSomething&#34;</span><span class=o>);</span>
 <span class=kd>super</span><span class=o>.</span><span class=na>doSomething</span><span class=o>();</span>
 <span class=o>}</span>
<span class=o>}</span> 
</code></pre></td></tr></table></div></div><p>In the above example calls to the super class method would deadlock without re-entrant locks. Re-entrancy saves us from this deadlock situation.</p><h4 id=guarding-state-with-locks>Guarding state with locks</h4><p>Because locks enable serialized access (Serializing access means threads take turns accessing the object exclusively, rather than doing concurrently) to the code paths they guard, we can use them to construct protocols for guaranteeing exclusive access to the shared state.</p><p>Compound actions on shared state such as incrementing hit counter (read-modify-write) or lazy initialization (check-then-act) must be atomic to avoid race conditions.<br>Just wrapping the compound action with a <code>synchronized</code> block is not sufficient.</p><ol><li>If synchronization is used to coordinate access to a variable, it is needed everywhere that variable is accessed.</li><li>When using locks to coordinate access to a variable, the same lock must be used wherever that variable is accessed.</li></ol><div class=box>For each mutable state variable that may be accessed by more than one thread, all access to that variable must be performed with the same lock held. In this case, we say that the variable is guarded by that lock.</div><div class=box>Every shared, mutable variable should be guarded by exactly one lock and should be made clear to maintainers which lock it is.</div><p>A common locking convention is to encapsulate all mutable state within an object to protect it from concurrent access by synchronizing any code path that access mutable state using the object&rsquo;s intrinsic lock. <em><strong>It is easy</strong></em> to subvert this locking protocol accidentally by adding a new method or code path and forgetting to use synchronization.</p><p>Adding synchronization to every method is not enough. For example, <code>put-if-absent</code> operation has a race condition, even though both <code>contains</code> and <code>add</code> are atomic (When multiple operations are combined into a compound action).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=k>if</span> <span class=o>(!</span><span class=n>vector</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>element</span><span class=o>))</span>
 <span class=n>vector</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>element</span><span class=o>);</span>
</code></pre></td></tr></table></div></div><p>At the same time, synchronizing every method can lead to <em><strong>liveness or performance problems</strong></em>.</p><h4 id=liveness-and-performance>Liveness and Performance</h4><p>It is easy to improve the concurrency of a component while maintaining thread safety by <em><strong>narrowing the scope of synchronized block</strong></em>. However, the scope of the synchronized block should not be too small - an atomic operation should not be divided into to more than one synchronized block.<br>It is reasonable to exclude long-running operations <em><strong>that do not affect shared state</strong></em> so that other threads are not prevented from accessing the shared state while the long-running operation is in progress.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@NotThreadSafe</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UnsafeCachingFactorizer</span> <span class=kd>implements</span> <span class=n>Servlet</span> <span class=o>{</span>
  <span class=kd>private</span> <span class=kd>final</span> <span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>BigInteger</span><span class=o>&gt;</span> <span class=n>lastNumber</span>
  <span class=o>=</span> <span class=k>new</span> <span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>BigInteger</span><span class=o>&gt;();</span>
  <span class=kd>private</span> <span class=kd>final</span> <span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>BigInteger</span><span class=o>[]&gt;</span> <span class=n>lastFactors</span>
  <span class=o>=</span> <span class=k>new</span> <span class=n>AtomicReference</span><span class=o>&lt;</span><span class=n>BigInteger</span><span class=o>[]&gt;();</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>BigInteger</span> <span class=n>i</span> <span class=o>=</span> <span class=n>extractFromRequest</span><span class=o>(</span><span class=n>req</span><span class=o>);</span>
  <span class=k>if</span> <span class=o>(</span><span class=n>i</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>lastNumber</span><span class=o>.</span><span class=na>get</span><span class=o>()))</span>
    <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>lastFactors</span><span class=o>.</span><span class=na>get</span><span class=o>()</span> <span class=o>);</span>
  <span class=k>else</span> <span class=o>{</span>
    <span class=n>BigInteger</span><span class=o>[]</span> <span class=n>factors</span> <span class=o>=</span> <span class=n>factor</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
    <span class=n>lastNumber</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
    <span class=n>lastFactors</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>factors</span><span class=o>);</span>
    <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>factors</span><span class=o>);</span>
  <span class=o>}</span>
 <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>The above example has race conditions.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@ThreadSafe</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SynchronizedFactorizer</span> <span class=kd>implements</span> <span class=n>Servlet</span> <span class=o>{</span>
 <span class=nd>@GuardedBy</span><span class=o>(</span><span class=s>&#34;this&#34;</span><span class=o>)</span> <span class=kd>private</span> <span class=n>BigInteger</span> <span class=n>lastNumber</span><span class=o>;</span>
 <span class=nd>@GuardedBy</span><span class=o>(</span><span class=s>&#34;this&#34;</span><span class=o>)</span> <span class=kd>private</span> <span class=n>BigInteger</span><span class=o>[]</span> <span class=n>lastFactors</span><span class=o>;</span>
 <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span>
 <span class=n>ServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=o>{</span>
  <span class=n>BigInteger</span> <span class=n>i</span> <span class=o>=</span> <span class=n>extractFromRequest</span><span class=o>(</span><span class=n>req</span><span class=o>);</span>
 <span class=k>if</span> <span class=o>(</span><span class=n>i</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>lastNumber</span><span class=o>))</span>
  <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>lastFactors</span><span class=o>);</span>
 <span class=k>else</span> <span class=o>{</span>
  <span class=n>BigInteger</span><span class=o>[]</span> <span class=n>factors</span> <span class=o>=</span> <span class=n>factor</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
  <span class=n>lastNumber</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
  <span class=n>lastFactors</span> <span class=o>=</span> <span class=n>factors</span><span class=o>;</span>
  <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>factors</span><span class=o>);</span>
 <span class=o>}</span>
 <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>In the above example, the servlet caches the last result but has unacceptable concurrency. Only one thread can use the servlet at a time, defeating the purpose of using servlets.</p><figure><img data-src=/notes/java_concurrency_in_practice/Clipboard_2022-11-24-01-28-59.png alt="Serialized access" data-caption=https://jcip.net/ src=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjRwdCIgaGVpZ2h0PSIyNHB0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxnIGlkPSJzdXJmYWNlMTAzNTc5NSI+PHBhdGggc3R5bGU9InN0cm9rZTpub25lO2ZpbGwtcnVsZTpub256ZXJvO2ZpbGw6I2NjYztmaWxsLW9wYWNpdHk6MSIgZD0iTTQgNEMyLjkwNjI1IDQgMiA0LjkwNjI1IDIgNlYxOGMwIDEuMDkzNzUuOTA2MjUgMiAyIDJIMjBjMS4wOTM3NS4wIDItLjkwNjI1IDItMlY2YzAtMS4wOTM3NS0uOTA2MjUtMi0yLTJ6TTQgNkgyMFYxOEg0ek00IDYiLz48L2c+PC9zdmc+ class=lazyload width=700px height><figcaption><strong>Serialized access</strong>:
https://jcip.net/</figcaption></figure><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@ThreadSafe</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>CachedFactorizer</span> <span class=kd>implements</span> <span class=n>Servlet</span> <span class=o>{</span>
 <span class=nd>@GuardedBy</span><span class=o>(</span><span class=s>&#34;this&#34;</span><span class=o>)</span> <span class=kd>private</span> <span class=n>BigInteger</span> <span class=n>lastNumber</span><span class=o>;</span>
 <span class=nd>@GuardedBy</span><span class=o>(</span><span class=s>&#34;this&#34;</span><span class=o>)</span> <span class=kd>private</span> <span class=n>BigInteger</span><span class=o>[]</span> <span class=n>lastFactors</span><span class=o>;</span>
 <span class=nd>@GuardedBy</span><span class=o>(</span><span class=s>&#34;this&#34;</span><span class=o>)</span> <span class=kd>private</span> <span class=kt>long</span> <span class=n>hits</span><span class=o>;</span>
 <span class=nd>@GuardedBy</span><span class=o>(</span><span class=s>&#34;this&#34;</span><span class=o>)</span> <span class=kd>private</span> <span class=kt>long</span> <span class=n>cacheHits</span><span class=o>;</span>
 <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>long</span> <span class=nf>getHits</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>hits</span><span class=o>;</span> <span class=o>}</span>
 <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>double</span> <span class=nf>getCacheHitRatio</span><span class=o>()</span> <span class=o>{</span>
  <span class=k>return</span> <span class=o>(</span><span class=kt>double</span><span class=o>)</span> <span class=n>cacheHits</span> <span class=o>/</span> <span class=o>(</span><span class=kt>double</span><span class=o>)</span> <span class=n>hits</span><span class=o>;</span>
 <span class=o>}</span>
 <span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>req</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>resp</span><span class=o>)</span> <span class=o>{</span>
  <span class=n>BigInteger</span> <span class=n>i</span> <span class=o>=</span> <span class=n>extractFromRequest</span><span class=o>(</span><span class=n>req</span><span class=o>);</span>
  <span class=n>BigInteger</span><span class=o>[]</span> <span class=n>factors</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
  <span class=kd>synchronized</span> <span class=o>(</span><span class=k>this</span><span class=o>)</span> <span class=o>{</span>
    <span class=o>++</span><span class=n>hits</span><span class=o>;</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>i</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>lastNumber</span><span class=o>))</span> <span class=o>{</span>
    <span class=o>++</span><span class=n>cacheHits</span><span class=o>;</span>
    <span class=n>factors</span> <span class=o>=</span> <span class=n>lastFactors</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
    <span class=o>}</span>
  <span class=o>}</span>
 <span class=k>if</span> <span class=o>(</span><span class=n>factors</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>factors</span> <span class=o>=</span> <span class=n>factor</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
    <span class=kd>synchronized</span> <span class=o>(</span><span class=k>this</span><span class=o>)</span> <span class=o>{</span>
      <span class=n>lastNumber</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
      <span class=n>lastFactors</span> <span class=o>=</span> <span class=n>factors</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
    <span class=o>}</span>
  <span class=o>}</span>
 <span class=n>encodeIntoResponse</span><span class=o>(</span><span class=n>resp</span><span class=o>,</span> <span class=n>factors</span><span class=o>);</span>
 <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>By narrowing the scope of the synchronized block, concurrency of the servlet can be improved while maintaining thread safety.</p><p>The above example uses two synchronized block, each limited to a short section of code.</p><ol><li>One guards the <code>check-then-act</code> that tests whether we can just return the cached result.</li><li>The other guards the update of cached number and the cached factors.</li></ol><p>The portions of code that are outside the <code>synchronized blocks</code> operate exclusively on local variables, which are not shared across threads and therefore do not require synchronization.</p><p>Acquiring and releasing a lock has some overhead, so it is undesirable to break down synchronized blocks too far (even though it would not compromize atomicity).</p><p>CachedFactorizer holds the lock when accessing state variables and for the duration of compound actions but releases it before executing the potentially long-running factorization operation. This preserves thread safety without affecting concurrency.</p><div class=box>when implementing a synchronization policy, resist the temptation to prematurely sacrifice simplicity (potentially compromising safety) for the sake of performance.</div><div class=box><p>Holding a lock for a long time, either due to compute-intensive tasks or due to a blocking operation, introduces the risk of liveness or performance problems.</p><p>Avoid holding locks during lengthy computations or operations at risk of not completing quickly such as netowrk or console I/O.</p></div></article></div></article><section id=list-side class=r data-dir=ltr><div class=toc><h6 class=toc__label>What's on this Page</h6><div class=toc__body><nav id=TableOfContents><ul><li><a href=#state-of-an-object>State of an object</a></li><li><a href=#thread-safety>Thread safety</a></li><li><a href=#what-is-thread-safety>What is Thread Safety?</a><ul><li><a href=#stateless-servlet>Stateless servlet</a></li></ul></li><li><a href=#atomicity>Atomicity</a></li><li><a href=#race-conditions>Race conditions</a><ul><li><a href=#check-then-act>check-then-act</a></li><li><a href=#read-modify-write>read-modify-write</a></li></ul></li><li><a href=#compounded-actions>Compounded Actions</a></li><li><a href=#locking>Locking</a></li><li><a href=#reentrancy>Reentrancy</a></li><li><a href=#guarding-state-with-locks>Guarding state with locks</a></li><li><a href=#liveness-and-performance>Liveness and Performance</a></li></ul></nav></div></div></section></div></div><script>'use strict';function wrap(el,wrapper){el.parentNode.insertBefore(wrapper,el);wrapper.appendChild(el);}
(function(){var singleContentsElem=document.querySelector('.single__contents');singleContentsElem?singleContentsElem.querySelectorAll('pre > code').forEach(function(elem){var dataLang=elem.getAttribute('data-lang');var dataLangWrapper=document.createElement('div');var code=null;var codeTitle=null;if(dataLang&&dataLang.includes(':')){code=dataLang.split(':')[0];codeTitle=dataLang.split(':')[1];dataLangWrapper.className='language-'+code;dataLangWrapper.setAttribute('data-lang',codeTitle);elem.className='language-'+code;elem.setAttribute('data-lang',codeTitle);elem.setAttribute('id',codeTitle);}
if(!dataLang||codeTitle){wrap(elem.parentNode,dataLangWrapper);}}):null;})();var dollarCodeElem=document.querySelectorAll('div.language-\\$');var gtCodeElem=document.querySelectorAll('div.language-\\>');dollarCodeElem?dollarCodeElem.forEach(function(elem){var lnts=elem.parentNode.parentNode?elem.parentNode.parentNode.querySelectorAll('.lnt'):null;lnts?lnts.forEach(function(lnt){lnt.innerHTML='$<br/>';}):null;}):null;gtCodeElem?gtCodeElem.forEach(function(elem){var lnts=elem.parentNode.parentNode?elem.parentNode.parentNode.querySelectorAll('.lnt'):null;lnts?lnts.forEach(function(lnt){lnt.innerHTML='><br/>';}):null;}):null;</script><script defer src=/js/helper/getParents.min.js></script><script defer src=/js/helper/closest.min.js></script><script defer src=/js/helper/prev.min.js></script><script defer src=/js/helper/prop.min.js></script><script defer src=/js/helper/fadeinout.min.js></script><script>document.addEventListener('DOMContentLoaded',function(){'use strict';var tables=document.querySelectorAll('.single__contents > table');for(let i=0;i<tables.length;i++){var table=tables[i];var wrapper=document.createElement('div');wrapper.className='table-wrapper';table.parentElement.replaceChild(wrapper,table);wrapper.appendChild(table);}
var lib=JSON.parse("null");if(lib&&lib.includes('mermaid')){var themeVariant=localStorage.getItem('theme')||'light';if(themeVariant==="dark"){mermaid.initialize({theme:'dark'});}else{mermaid.initialize({theme:'default'});}
var mermaids=[];[].push.apply(mermaids,document.getElementsByClassName('language-mermaid'));mermaids.forEach(function(elem){var elemParentNode=elem.parentNode;if(elemParentNode!==document.body){elemParentNode.parentNode.insertBefore(elem,elemParentNode);elemParentNode.parentNode.removeChild(elemParentNode);}
var newElemWrapper=document.createElement('div');newElemWrapper.classList.add('mermaid');newElemWrapper.innerHTML=elem.innerHTML;elem.replaceWith(newElemWrapper);});}
if(lib&&lib.includes('katex')){var mathElements=document.getElementsByClassName('math');var options={delimiters:[{left:"$$",right:"$$",display:true},{left:"\\[",right:"\\]",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false}],};renderMathInElement(document.querySelector('.single__contents'),options);}
if(lib&&lib.includes('flowchartjs')){var options=JSON.parse("{\"arrow-end\":\"block\",\"element-color\":\"black\",\"fill\":\"white\",\"flowstate\":{\"approved\":{\"fill\":\"#58C4A3\",\"font-size\":12,\"no-text\":\"n/a\",\"yes-text\":\"APPROVED\"},\"current\":{\"fill\":\"yellow\",\"font-color\":\"red\",\"font-weight\":\"bold\"},\"future\":{\"fill\":\"#FFFF99\"},\"invalid\":{\"fill\":\"#444444\"},\"past\":{\"fill\":\"#CCCCCC\",\"font-size\":12},\"rejected\":{\"fill\":\"#C45879\",\"font-size\":12,\"no-text\":\"REJECTED\",\"yes-text\":\"n/a\"},\"request\":{\"fill\":\"blue\"}},\"font-color\":\"black\",\"font-size\":14,\"line-color\":\"black\",\"line-length\":50,\"line-width\":3,\"no-text\":\"no\",\"scale\":1,\"symbols\":{\"end\":{\"class\":\"end-element\"},\"start\":{\"element-color\":\"green\",\"fill\":\"yellow\",\"font-color\":\"red\"}},\"text-margin\":10,\"x\":0,\"y\":0,\"yes-text\":\"yes\"}");var jsonContent=null;var flowchartPrefix="language-flowchart";var index=0;Array.prototype.forEach.call(document.querySelectorAll("[class^="+flowchartPrefix+"]"),function(x){x.style.display='none'
x.parentNode.style.backgroundColor="transparent"
jsonContent=x.innerText;var node0=document.createElement('div');node0.id='flowchart'+index;x.parentNode.insertBefore(node0,x);var diagram=flowchart.parse(jsonContent);diagram.drawSVG("flowchart"+index,options);index+=1;});}
if(lib&&lib.includes('chart')){var borderColor="#666";var bgColor="#ddd";var borderWidth=2;Chart.defaults.global.elements.rectangle.borderWidth=borderWidth;Chart.defaults.global.elements.rectangle.borderColor=borderColor;Chart.defaults.global.elements.rectangle.backgroundColor=bgColor;Chart.defaults.global.elements.line.borderWidth=borderWidth;Chart.defaults.global.elements.line.borderColor=borderColor;Chart.defaults.global.elements.line.backgroundColor=bgColor;Chart.defaults.global.elements.point.borderWidth=borderWidth;Chart.defaults.global.elements.point.borderColor=borderColor;Chart.defaults.global.elements.point.backgroundColor=bgColor;var chartPrefix="language-chart";var index=0;var jsonContent=null;Array.prototype.forEach.call(document.querySelectorAll("[class^="+chartPrefix+"]"),function(x){x.style.display='none'
x.parentNode.style.backgroundColor="transparent"
jsonContent=x.innerText;var node0=document.createElement('canvas');var source=null;node0.height=200;node0.style.height=200;node0.id='myChart'+index;source=JSON.parse(jsonContent);x.parentNode.insertBefore(node0,x);var ctx=document.getElementById('myChart'+index).getContext('2d');var myChart=new Chart(ctx,source);index+=1;});}
if(lib&&lib.includes('viz')){var vizPrefix="language-viz-";Array.prototype.forEach.call(document.querySelectorAll("[class^="+vizPrefix+"]"),function(x){x.style.display='none'
x.parentNode.style.backgroundColor="transparent"
var engine;x.getAttribute("class").split(" ").forEach(function(cls){if(cls.startsWith(vizPrefix)){engine=cls.substr(vizPrefix.length);}});var viz=new Viz();viz.renderSVGElement(x.innerText,{engine:engine}).then(function(element){element.style.width="100%";x.parentNode.insertBefore(element,x);})});}});</script><script>var listSide=document.getElementById('list-side');var listMain=document.getElementById('list-main');var singleMenu=document.getElementById('single-menu');var switchElem=document.querySelector('.switch');var wideViewAsDefault=JSON.parse("null");enquire.register("screen and (max-width:1280px)",{match:function(){if(wideViewAsDefault){singleMenu.className='l';listMain.className='mr';listSide.className='hide';}else{singleMenu.className='l';listMain.className='m';listSide.className='r';}},unmatch:function(){if(wideViewAsDefault){singleMenu.className='l';listMain.className='mr';listSide.className='hide';}else{listSide.className='r';listMain.className='m';singleMenu.className='l';}},}).register("screen and (max-width:960px)",{match:function(){singleMenu.className='l';listMain.className='mr';listSide.className='hide';switchElem.className='hide';},unmatch:function(){if(wideViewAsDefault){singleMenu.className='l';listMain.className='mr';listSide.className='hide';}else{singleMenu.className='l';listMain.className='m';listSide.className='r';}
switchElem.className='switch';},}).register("screen and (max-width:600px)",{match:function(){listSide.className='hide';listMain.className='lmr';singleMenu.className='hide';switchElem.className='hide';},unmatch:function(){listSide.className='hide';listMain.className='mr';singleMenu.className='l';switchElem.className='hide';},});</script><div class=bot><footer class=footer><div class=divider><div class=lmr><p class=caption>Â©2022, All Rights Reserved</p></div></div></footer></div></div></body></html>